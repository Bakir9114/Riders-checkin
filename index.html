<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check-in Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #container {
            max-width: 300px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div id="container">
        <h2>Check-in</h2>
        <input type="text" id="name" placeholder="Enter your name">
        <button onclick="checkIn()">Check-in</button>
        <p id="message"></p>
    </div>

    <script>
        const STORE_LAT = 28.460870;
        const STORE_LON = 77.079445;
        const RADIUS = 500; // 500 meters

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;
            
            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function checkIn() {
            let name = document.getElementById("name").value;
            if (name.trim() === "") {
                alert("Please enter your name");
                return;
            }
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userLat = position.coords.latitude;
                    const userLon = position.coords.longitude;
                    const distance = getDistance(userLat, userLon, STORE_LAT, STORE_LON);
                    
                    if (distance > RADIUS) {
                        document.getElementById("message").innerHTML = "You are too far from the check-in location.";
                        return;
                    }
                    
                    let url = "https://script.google.com/macros/s/AKfycbxN786QQAGD87d6hlJPOgLMkrHiXQyXtpK-4CX3TWYywEr3eS4iGy63BjG3TncrZ1oslg/exec";
                    
                    fetch(url, {
                        method: "POST",
                        mode: "no-cors",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ name: name })
                    })
                    .then(() => {
                        document.getElementById("message").innerHTML = "Check-in successful!";
                        document.getElementById("name").value = "";
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        document.getElementById("message").innerHTML = "An error occurred. Please check your internet connection and try again.";
                    });
                }, () => {
                    document.getElementById("message").innerHTML = "Location access denied. Please enable location and try again.";
                });
            } else {
                document.getElementById("message").innerHTML = "Geolocation is not supported by your browser.";
            }
        }
    </script>
</body>
</html>
