<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCIS (Rider Check-In System)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Style for Google Button */
        .google-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #4285F4;
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 1.125rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .google-btn:hover {
            background-color: #357ae8;
        }
        .google-btn svg {
            margin-right: 0.75rem;
            background: white;
            border-radius: 50%;
            padding: 2px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="flex flex-col items-center bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full">
        <h1 class="text-5xl font-extrabold text-gray-800 mb-6 text-center leading-tight">
            RCIS (Rider Check-In System)
        </h1>

        <!-- Authentication Section -->
        <div id="auth-section" class="w-full max-w-md mb-8 text-center">
            <div id="user-info" class="hidden mb-4 text-lg">
                <p>Welcome, <span id="user-name" class="font-bold"></span>!</p>
                <p id="user-email" class="text-gray-600"></p>
            </div>
            <button id="google-signin-btn" class="google-btn">
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 48 48">
                    <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.99,36.566,44,31.016,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                </svg>
                Sign in with Google
            </button>
            <button id="signout-btn" class="hidden px-6 py-3 text-lg font-semibold text-white bg-red-600 rounded-lg shadow-md transition-all duration-300 hover:bg-red-700">
                Sign Out
            </button>
        </div>

        <div id="buttons" class="hidden flex flex-col sm:flex-row justify-center items-center space-y-6 sm:space-y-0 sm:space-x-8 w-full">
            <button id="check-in-button" onclick="showShiftTimeSelection()" class="px-10 py-6 text-2xl font-bold text-white bg-blue-600 rounded-xl shadow-lg transition-all duration-300 hover:bg-blue-700 hover:scale-105 w-full sm:w-auto focus:outline-none focus:ring-4 focus:ring-blue-300">
                Check-In
            </button>
            <button id="check-out-button" onclick="submitData('checkout')" class="px-10 py-6 text-2xl font-bold text-white bg-green-600 rounded-xl shadow-lg transition-all duration-300 hover:bg-green-700 hover:scale-105 w-full sm:w-auto focus:outline-none focus:ring-4 focus:ring-green-300">
                Check-Out
            </button>
        </div>

        <div id="shift-time-selection" class="hidden mt-8 text-center flex flex-col items-center space-y-4 w-full">
            <label for="shift-time-select" class="text-xl font-semibold text-gray-700">Select Shift Time:</label>
            <select id="shift-time-select" class="p-4 text-xl rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm w-full max-w-xs sm:max-w-md">
                <option value="">Select Shift Time</option>
                <option value="7 AM to 5 PM">7 AM to 5 PM</option>
                <option value="8 AM to 6 PM">8 AM to 6 PM</option>
                <option value="4 PM to 2 AM">4 PM to 2 AM</option>
                <option value="8 AM to 6 AM">8 AM to 6 AM</option>
                <option value="10 PM to 8 AM">10 PM to 8 AM</option>
                <option value="Other (In Emergency Only)">Other (In Emergency Only)</option>
            </select>
            <button id="confirm-shift-button" onclick="submitData('checkin')" class="px-8 py-4 text-xl font-bold text-white bg-blue-600 rounded-xl shadow-lg transition-all duration-300 hover:bg-blue-700 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                Confirm Shift
            </button>
        </div>
    </div>

    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center" id="modal-content-wrapper">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4"></h3>
            <p id="modal-message" class="text-lg text-gray-700 mb-6"></p>
            <button id="modal-ok-button" onclick="hideModal()" class="px-6 py-3 text-lg font-semibold text-white bg-blue-600 rounded-lg shadow-md transition-all duration-300 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">
                OK
            </button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script>
        // Firebase Config has been updated with your project details.
        const firebaseConfig = {
            apiKey: "AIzaSyBToBsWccnzG4xvZT7SqiKBaFGcR8bLPjg",
            authDomain: "riders-check-in-check-out.firebaseapp.com",
            projectId: "riders-check-in-check-out",
            storageBucket: "riders-check-in-check-out.firebasestorage.app",
            messagingSenderId: "563496526463",
            appId: "1:563496526463:web:867574b572dbca6e8f554a",
            measurementId: "G-0LF7PYCFFQ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxI9JQKQGg9WHtkfwisKFnNd8TJAxaPMQGH64VperTU3-cpKzE-aNPfYwzsqsukamlgkw/exec';

        // --- FIXED: Wait for the DOM to be fully loaded before running the script ---
        document.addEventListener('DOMContentLoaded', function() {
            // UI Elements
            const googleSignInBtn = document.getElementById('google-signin-btn');
            const signOutBtn = document.getElementById('signout-btn');
            const userInfoDiv = document.getElementById('user-info');
            const userNameSpan = document.getElementById('user-name');
            const userEmailSpan = document.getElementById('user-email');
            const actionButtonsDiv = document.getElementById('buttons');

            // Event Listeners
            googleSignInBtn.onclick = () => auth.signInWithPopup(provider);
            signOutBtn.onclick = () => auth.signOut();

            // Authentication State Listener
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    userNameSpan.textContent = user.displayName;
                    userEmailSpan.textContent = user.email;
                    userInfoDiv.classList.remove('hidden');
                    googleSignInBtn.classList.add('hidden');
                    signOutBtn.classList.remove('hidden');
                    actionButtonsDiv.classList.remove('hidden'); // Show Check-In/Out buttons
                } else {
                    // User is signed out
                    userInfoDiv.classList.add('hidden');
                    googleSignInBtn.classList.remove('hidden');
                    signOutBtn.classList.add('hidden');
                    actionButtonsDiv.classList.add('hidden'); // Hide Check-In/Out buttons
                    document.getElementById('shift-time-selection').classList.add('hidden');
                }
            });
        });


        // These functions are defined globally so they can be called by onclick attributes in the HTML
        function showModal(title, message, showOkButton = true) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-message').innerText = message;
            document.getElementById('modal-ok-button').style.display = showOkButton ? 'inline-block' : 'none';
            document.getElementById('custom-modal').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('custom-modal').classList.add('hidden');
        }

        function disableAllInputs() {
            // Also disable the signout button
            const signOutBtn = document.getElementById('signout-btn');
            if(signOutBtn) signOutBtn.disabled = true;

            document.getElementById('check-in-button').disabled = true;
            document.getElementById('check-out-button').disabled = true;
            document.getElementById('confirm-shift-button').disabled = true;
        }

        function showShiftTimeSelection() {
            document.getElementById('buttons').classList.add('hidden');
            document.getElementById('shift-time-selection').classList.remove('hidden');
        }

        async function submitData(type) {
            const user = auth.currentUser;
            if (!user) {
                showModal('Error', 'Aap sign in nahi hain. Kripya pehle sign in karein.');
                return;
            }

            const shiftTime = document.getElementById('shift-time-select').value;
            if (type === 'checkin' && !shiftTime) {
                showModal('Error', 'Kripya aage badhne ke liye shift time chunein.');
                return;
            }

            showModal('Processing...', 'Aapka data submit kiya ja raha hai...', false);

            const dataPayload = {
                type: type,
                shiftTime: type === 'checkin' ? shiftTime : null,
                riderName: user.displayName,
                riderEmail: user.email
            };

            try {
                await fetch(APPS_SCRIPT_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(dataPayload)
                });
                
                showModal('Success!', `Aapka ${type} safaltapoorvak record ho gaya hai.`);
                disableAllInputs();

            } catch (error) {
                console.error('Error:', error);
                showModal('Error', 'Ek error aa gayi hai. Kripya dobara try karein.');
            }
        }
    </script>
</body>
</html>
